var _=Object.defineProperty;var U=(i,t,e)=>t in i?_(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var A=(i,t,e)=>(U(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function e(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=e(o);fetch(o.href,n)}})();class X{constructor(){this.toLoad={sky:"sprites/sky.png",ground:"sprites/ground.png",hero:"sprites/hero-sheet.png",shadow:"sprites/shadow.png",rod:"sprites/rod.png",house:"sprites/house.png",mail:"sprites/mail.png",icon:"sprites/icon.png",letter:"sprites/letter.png"},this.images={},Object.keys(this.toLoad).forEach(t=>{const e=new Image;e.src=this.toLoad[t],this.images[t]={image:e,isLoaded:!1},e.onload=()=>{this.images[t].isLoaded=!0}})}}const k=new X;class l{constructor(t=0,e=0){this.x=t,this.y=e}duplicate(){return new l(this.x,this.y)}}class B{constructor(){A(this,"callbacks",[]);A(this,"nextId",0)}emit(t,e){this.callbacks.forEach(s=>{s.eventName===t&&s.callback(e)})}on(t,e,s){return this.nextId+=1,this.callbacks.push({id:this.nextId,eventName:t,caller:e,callback:s}),this.nextId}off(t){this.callbacks=this.callbacks.filter(e=>e.id!==t)}unsubscribe(t){this.callbacks=this.callbacks.filter(e=>e.caller!==t)}}const R=new B;class C{constructor({position:t}){this.position=t??new l(0,0),this.children=[],this.parent=null,this.hasReadyBeenCalled=!1}stepEntry(t,e){this.children.forEach(s=>s.stepEntry(t,e)),this.hasReadyBeenCalled||(this.hasReadyBeenCalled=!0,this.ready()),this.step(t,e)}ready(){}step(t){}draw(t,e,s){const o=e+this.position.x,n=s+this.position.y;this.drawImage(t,o,n),this.children.forEach(d=>d.draw(t,o,n))}drawImage(t,e,s){}destroy(){this.children.forEach(t=>{t.destroy()}),this.parent.removeChild(this)}addChild(t){t.parent=this,this.children.push(t)}removeChild(t){R.unsubscribe(t),this.children=this.children.filter(e=>t!==e)}}class g extends C{constructor({resource:t,frameSize:e,hFrames:s,vFrames:o,frame:n,scale:d,position:c,animations:h}){super({name}),this.resource=t,this.frameSize=e??new l(16,16),this.hFrames=s??1,this.vFrames=o??1,this.frame=n??0,this.frameMap=new Map,this.scale=d??1,this.position=c??new l(0,0),this.animations=h??null,this.buildFrameMap()}buildFrameMap(){let t=0;for(let e=0;e<this.vFrames;e++)for(let s=0;s<this.hFrames;s++)this.frameMap.set(t,new l(this.frameSize.x*s,this.frameSize.y*e)),t++}step(t){this.animations&&(this.animations.step(t),this.frame=this.animations.frame)}drawImage(t,e,s){if(!this.resource.isLoaded)return;let o=0,n=0;const d=this.frameMap.get(this.frame);d&&(o=d.x,n=d.y);const c=this.frameSize.x,h=this.frameSize.y;t.drawImage(this.resource.image,o,n,c,h,e,s,c*this.scale,h*this.scale)}}class q{constructor(t,e){A(this,"mainLoop",t=>{if(!this.isRunning)return;let e=t-this.lastFrameTime;for(this.lastFrameTime=t,this.accumulatedTime+=e;this.accumulatedTime>=this.timeStep;)this.update(this.timeStep),this.accumulatedTime-=this.timeStep;this.render(),this.rafId=requestAnimationFrame(this.mainLoop)});this.lastFrameTime=0,this.accumulatedTime=0,this.timeStep=1e3/60,this.update=t,this.render=e,this.rafId=null,this.isRunning=!1}start(){this.isRunning||(this.isRunning=!0,this.rafId=requestAnimationFrame(this.mainLoop))}stop(){this.rafId&&cancelAnimationFrame(this.rafId),this.isRunning=!1}}const D="LEFT",W="RIGHT",z="UP",L="DOWN";class G{constructor(){this.heldDirections=[],document.addEventListener("keydown",t=>{(t.code==="ArrowUp"||t.code==="KeyW")&&this.onArrowPressed(z),(t.code==="ArrowDown"||t.code==="KeyS")&&this.onArrowPressed(L),(t.code==="ArrowLeft"||t.code==="KeyA")&&this.onArrowPressed(D),(t.code==="ArrowRight"||t.code==="KeyD")&&this.onArrowPressed(W)}),document.addEventListener("keyup",t=>{(t.code==="ArrowUp"||t.code==="KeyW")&&this.onArrowReleased(z),(t.code==="ArrowDown"||t.code==="KeyS")&&this.onArrowReleased(L),(t.code==="ArrowLeft"||t.code==="KeyA")&&this.onArrowReleased(D),(t.code==="ArrowRight"||t.code==="KeyD")&&this.onArrowReleased(W)})}get direction(){return this.heldDirections[0]}onArrowPressed(t){this.heldDirections.indexOf(t)===-1&&this.heldDirections.unshift(t)}onArrowReleased(t){const e=this.heldDirections.indexOf(t);e!==-1&&this.heldDirections.splice(e,1)}}const b=i=>i*16,$=(i,t,e)=>{const s=`${t},${e}`;return!i.has(s)},M=new Set;M.add("144,48");M.add("160,48");M.add("176,64");M.add("128,48");M.add("112,48");class j{constructor(t){this.patterns=t,this.activeKey=Object.keys(this.patterns)[0]}get frame(){return this.patterns[this.activeKey].frame}play(t,e=0){this.activeKey!==t&&(this.activeKey=t,this.patterns[this.activeKey].currentTime=e)}step(t){this.patterns[this.activeKey].step(t)}}class v{constructor(t){this.currentTime=0,this.animationConfig=t,this.duration=t.duration??500}get frame(){const{frames:t}=this.animationConfig;for(let e=t.length-1;e>=0;e--)if(this.currentTime>=t[e].time)return t[e].frame;throw"Time is before the first keyframe"}step(t){this.currentTime+=t,this.currentTime>=this.duration&&(this.currentTime=0)}}const O=(i=0)=>({duration:400,frames:[{time:0,frame:i}]}),F=(i=0)=>({duration:400,frames:[{time:0,frame:i+1},{time:100,frame:i},{time:200,frame:i+1},{time:300,frame:i+2}]}),Z=O(1),J=O(4),Q=O(7),V=O(10),tt=F(0),et=F(3),it=F(6),st=F(9),nt={duration:400,frames:[{time:0,frame:12}]};function ot(i,t,e){let s=t.x-i.position.x,o=t.y-i.position.y,n=Math.sqrt(s**2+o**2);if(n<=e)i.position.x=t.x,i.position.y=t.y;else{let d=s/n,c=o/n;i.position.x+=d*e,i.position.y+=c*e,s=t.x-i.position.x,o=t.y-i.position.y,n=Math.sqrt(s**2+o**2)}return n}class rt extends C{constructor(e,s){super({position:new l(e,s)});A(this,"w");const o=new g({resource:k.images.shadow,frameSize:new l(32,32),position:new l(-8,-19)});this.addChild(o),this.body=new g({resource:k.images.hero,frameSize:new l(32,32),hFrames:3,vFrames:8,frame:1,position:new l(-8,-20),animations:new j({walkDown:new v(tt),walkUp:new v(it),walkLeft:new v(st),walkRight:new v(et),standDown:new v(Z),standUp:new v(Q),standLeft:new v(V),standRight:new v(J),pickUpDown:new v(nt)})}),this.addChild(this.body),this.facingDirection=L,this.destinationPosition=this.position.duplicate(),this.itemPickupTime=0,this.itemPickupShell=null,R.on("HERO_PICKS_UP_ITEM",this,n=>{this.onPickUpItem(n)})}step(e,s){if(this.itemPickupTime>0){this.workOnItemPickup(e);return}ot(this,this.destinationPosition,1)<=1&&this.tryMove(s),this.tryEmitPosition()}tryEmitPosition(){this.lastX===this.position.x&&this.lastY===this.position.y||(this.lastX=this.position.x,this.lastY=this.position.y,Math.floor(this.position.x/16),Math.floor(this.position.y/16),R.emit("HERO_POSITION",this.position))}tryMove(e){const{input:s}=e;if(!s.direction){this.facingDirection===D&&this.body.animations.play("standLeft"),this.facingDirection===W&&this.body.animations.play("standRight"),this.facingDirection===z&&this.body.animations.play("standUp"),this.facingDirection===L&&this.body.animations.play("standDown");return}let o=this.destinationPosition.x,n=this.destinationPosition.y;const d=16;s.direction===L&&(n+=d,this.body.animations.play("walkDown")),s.direction===z&&(n-=d,this.body.animations.play("walkUp")),s.direction===D&&(o-=d,this.body.animations.play("walkLeft")),s.direction===W&&(o+=d,this.body.animations.play("walkRight")),this.facingDirection=s.direction??this.facingDirection,$(M,o,n)&&(this.destinationPosition.x=o,this.destinationPosition.y=n)}onPickUpItem({image:e,position:s}){this.destinationPosition=s.duplicate(),this.itemPickupTime=500,this.itemPickupShell=new C({}),this.itemPickupShell.addChild(new g({resource:e,position:new l(0,-18)})),this.addChild(this.itemPickupShell)}workOnItemPickup(e){this.itemPickupTime-=e,this.body.animations.play("pickUpDown"),this.itemPickupTime<=0&&this.itemPickupShell.destroy()}}class at extends C{constructor(){super({}),R.on("HERO_POSITION",this,t=>{this.position=new l(-t.x+152,-t.y+82)})}}class dt extends C{constructor(){super({position:new l(0,1)}),this.nextId=0,this.items=[],R.on("HERO_PICKS_UP_ITEM",this,t=>{this.nextId+=1,this.items.push({id:this.nextId,image:k.images.rod}),this.renderInventory()}),this.renderInventory()}renderInventory(){this.children.forEach(t=>t.destroy()),this.items.forEach((t,e)=>{const s=new g({resource:t.image,position:new l(e*12,0)});this.addChild(s)})}removeFromInventory(t){this.items=this.items.filter(e=>e.id!==t),this.renderInventory()}}const y=document.createElement("div");y.innerText="Will you be my valentine? ❤️ - Ken";y.style.position="absolute";y.style.fontFamily="'Press Start 2P', 'Courier New', monospace";y.style.fontSize="24px";y.style.color="#222";y.style.pointerEvents="none";y.style.display="none";document.body.appendChild(y);let Y=!1,m=null;const a=document.createElement("button");a.innerText="Yes";a.style.position="absolute";a.style.fontFamily="'Press Start 2P', 'Courier New', monospace";a.style.fontSize="18px";a.style.padding="8px 24px";a.style.display="none";a.style.zIndex=10;a.style.background="#e0c080";a.style.border="4px solid #7c5c2c";a.style.borderRadius="0";a.style.boxShadow="0 0 0 2px #fff inset, 2px 2px 0 #7c5c2c";a.style.color="#3a2a0a";a.style.textShadow="1px 1px 0 #fff, -1px -1px 0 #fff";a.style.cursor="pointer";a.style.outline="none";a.style.transition="background 0.2s, box-shadow 0.2s";a.addEventListener("mouseenter",()=>{a.style.background="#fff6d6",a.style.boxShadow="0 0 0 2px #fff inset, 4px 4px 0 #7c5c2c"});a.addEventListener("mouseleave",()=>{a.style.background="#e0c080",a.style.boxShadow="0 0 0 2px #fff inset, 2px 2px 0 #7c5c2c"});document.body.appendChild(a);const r=document.createElement("button");r.innerText="No";r.style.position="absolute";r.style.fontFamily="'Press Start 2P', 'Courier New', monospace";r.style.fontSize="18px";r.style.padding="8px 24px";r.style.display="none";r.style.zIndex=10;r.style.background="#e0c080";r.style.border="4px solid #7c5c2c";r.style.borderRadius="0";r.style.boxShadow="0 0 0 2px #fff inset, 2px 2px 0 #7c5c2c";r.style.color="#3a2a0a";r.style.textShadow="1px 1px 0 #fff, -1px -1px 0 #fff";r.style.cursor="pointer";r.style.outline="none";r.style.transition="background 0.2s, box-shadow 0.2s";r.addEventListener("mouseenter",()=>{r.style.background="#fff6d6",r.style.boxShadow="0 0 0 2px #fff inset, 4px 4px 0 #7c5c2c";const i=T.getBoundingClientRect(),t=window.innerWidth,e=window.innerHeight,s=100,o=40,n=Math.max(i.left,0),d=Math.min(i.right-s,t-s),c=Math.max(i.top,0),h=Math.min(i.bottom-o,e-o),p=n+Math.random()*(d-n),H=c+Math.random()*(h-c);r.style.left=Math.round(p)+"px",r.style.top=Math.round(H)+"px"});r.addEventListener("mouseleave",()=>{r.style.background="#e0c080",r.style.boxShadow="0 0 0 2px #fff inset, 2px 2px 0 #7c5c2c"});document.body.appendChild(r);a.addEventListener("click",()=>{const i=document.createElement("div");i.style.position="fixed",i.style.left="0",i.style.top="0",i.style.width="100vw",i.style.height="100vh",i.style.pointerEvents="none",i.style.zIndex="9998",i.style.transition="background 0.1s",document.body.appendChild(i);const t=["rgba(255,0,0,0.25)","rgba(0,255,0,0.25)","rgba(0,0,255,0.25)","rgba(255,255,0,0.25)","rgba(0,255,255,0.25)","rgba(255,0,255,0.25)","rgba(255,255,255,0.18)"];let e=0;if(setInterval(()=>{i.style.background=t[e%t.length],e++},200),m&&(m.remove(),m=null),m=document.createElement("div"),m.className="tenor-gif-embed",m.setAttribute("data-postid","11680171459206479686"),m.setAttribute("data-share-method","host"),m.setAttribute("data-aspect-ratio","1"),m.setAttribute("data-width","120px"),m.style.position="absolute",m.style.top="-800px",m.style.width="120px",m.style.maxWidth="120px",m.style.minWidth="120px",m.style.transform="translate(-50%, 0)",m.style.zIndex="10000",document.body.appendChild(m),!document.getElementById("tenor-embed-script")){const h=document.createElement("script");h.type="text/javascript",h.async=!0,h.src="https://tenor.com/embed.js",h.id="tenor-embed-script",document.body.appendChild(h)}new Audio("win.mp3").play(),new Audio("celebration.mp3").play(),u&&(u.destroy(),u=null,E=!1),x&&(x.destroy(),x=null,P=!1),y.style.display="none",a.style.display="none",r.style.display="none",Y=!0;const n=document.createElement("div");n.style.position="fixed",n.style.left="0",n.style.top="0",n.style.width="100vw",n.style.height="100vh",n.style.pointerEvents="none",n.style.zIndex="9999",document.body.appendChild(n);const d=["#f9d423","#ff4e50","#a1ffce","#38b2ac","#ff6e7f","#bfe9ff","#fbc2eb","#fdc2a2"];for(let h=0;h<80;h++){const p=document.createElement("div");p.style.position="absolute",p.style.width="12px",p.style.height="12px",p.style.background=d[Math.floor(Math.random()*d.length)],p.style.borderRadius=Math.random()>.5?"50%":"0",p.style.left=Math.random()*window.innerWidth+"px",p.style.top="0",p.style.opacity="0.85",p.style.transform=`rotate(${Math.random()*360}deg)`,p.style.boxShadow="0 2px 6px rgba(0,0,0,0.1)",p.style.animation=`confetti-fall ${2+Math.random()*2}s linear forwards`,n.appendChild(p)}const c=document.createElement("style");c.innerHTML=`@keyframes confetti-fall {
    0% { opacity: 0.85; }
    80% { opacity: 0.85; }
    100% { top: 100vh; opacity: 0; }
  }`,document.head.appendChild(c),setTimeout(()=>{n.remove(),c.remove()},4e3)});r.addEventListener("mouseenter",()=>{const i=T.getBoundingClientRect(),t=window.innerWidth,e=window.innerHeight,s=100,o=40,n=Math.max(i.left,0),d=Math.min(i.right-s,t-s),c=Math.max(i.top,0),h=Math.min(i.bottom-o,e-o),p=n+Math.random()*(d-n),H=c+Math.random()*(h-c);r.style.left=Math.round(p)+"px",r.style.top=Math.round(H)+"px"});const T=document.querySelector("#game-canvas"),f=T.getContext("2d");f.imageSmoothingEnabled=!1;const w=new C({position:new l(0,0)}),lt=new g({resource:k.images.sky,frameSize:new l(1920,960),scale:.3}),ct=new g({resource:k.images.ground,frameSize:new l(320,180),position:new l(b(-3),b(0))});w.addChild(ct);const ht=new g({resource:k.images.house,frameSize:new l(80,112),position:new l(b(7),b(-2))});w.addChild(ht);let x=null,P=!1,u=null,E=!1;window.addEventListener("keydown",i=>{i.key.toLowerCase()==="e"&&P&&!E&&(u=new g({resource:k.images.letter,frameSize:new l(1e3,180),scale:.5,position:new l(b(5),b(.5))}),w.addChild(u),E=!0)});const K=new g({resource:k.images.mail,frameSize:new l(200,200),scale:.3,position:new l(b(9.8),b(.5))});w.addChild(K);let N=0;const pt=K.position.y,I=new rt(b(9),b(4));w.addChild(I);const S=new at;w.addChild(S);const mt=new dt;w.input=new G;const ft=i=>{if(m){const c=T.getBoundingClientRect(),h=I.position.x+S.position.x+c.left;I.position.y+S.position.y+c.top-100,m.style.left=Math.round(h)+"px",m.style.top="-500px"}if(!P&&E&&u&&(u.destroy(),u=null,E=!1,y.style.display="none",a.style.display="none",r.style.display="none"),E&&u){y.style.display="block",a.style.display="block",r.style.display="block";const c=T.getBoundingClientRect(),h=u.position.x+S.position.x+c.left+400,p=u.position.y+S.position.y+c.top+180;y.style.left=Math.round(h)+"px",y.style.top=Math.round(p)+"px",a.style.left=Math.round(h)+"px",a.style.top=Math.round(p+40)+"px",(r.style.left===""||r.style.display==="none")&&(r.style.left=Math.round(h+120)+"px",r.style.top=Math.round(p+40)+"px")}else y.style.display="none",a.style.display="none",r.style.display="none";w.stepEntry(i,w),N+=i;const t=1,e=.004;K.position.y=pt+Math.sin(N*e)*t;const s=I.position.x,o=I.position.y,n=[{x:160,y:64},{x:176,y:80},{x:192,y:64}];let d=!1;for(const c of n)if(Math.abs(s-c.x)<2&&Math.abs(o-c.y)<2){d=!0;break}d?P?(x.position.x=s,x.position.y=o-24):(x=new g({resource:k.images.icon,frameSize:new l(1e3,1e3),scale:.02,position:new l(s-20,o-300)}),w.addChild(x),P=!0):P&&x&&(x.destroy(),x=null,P=!1)},yt=()=>{if(f.clearRect(0,0,T.width,T.height),lt.drawImage(f,0,0),f.save(),f.translate(S.position.x,S.position.y),w.draw(f,0,0),P&&I&&!E&&!Y){f.save(),f.font="bold 16px 'Press Start 2P', 'Courier New', monospace",f.fillStyle="#fff",f.strokeStyle="#000",f.lineWidth=2;const i="PRESS E",t=I.position.x+S.position.x-40,e=I.position.y+S.position.y+50;f.strokeText(i,t,e),f.fillText(i,t,e),f.restore()}f.restore(),mt.draw(f,0,0)},ut=new q(ft,yt);ut.start();
