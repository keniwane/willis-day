var _=Object.defineProperty;var U=(i,t,e)=>t in i?_(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var A=(i,t,e)=>(U(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();class X{constructor(){this.toLoad={sky:"sprites/sky.png",ground:"sprites/ground.png",hero:"sprites/hero-sheet.png",shadow:"sprites/shadow.png",rod:"sprites/rod.png",house:"sprites/house.png",mail:"sprites/mail.png",icon:"sprites/icon.png",letter:"sprites/letter.png"},this.images={},Object.keys(this.toLoad).forEach(t=>{const e=new Image;e.src=this.toLoad[t],this.images[t]={image:e,isLoaded:!1},e.onload=()=>{this.images[t].isLoaded=!0}})}}const S=new X;class l{constructor(t=0,e=0){this.x=t,this.y=e}duplicate(){return new l(this.x,this.y)}}class B{constructor(){A(this,"callbacks",[]);A(this,"nextId",0)}emit(t,e){this.callbacks.forEach(s=>{s.eventName===t&&s.callback(e)})}on(t,e,s){return this.nextId+=1,this.callbacks.push({id:this.nextId,eventName:t,caller:e,callback:s}),this.nextId}off(t){this.callbacks=this.callbacks.filter(e=>e.id!==t)}unsubscribe(t){this.callbacks=this.callbacks.filter(e=>e.caller!==t)}}const R=new B;class M{constructor({position:t}){this.position=t??new l(0,0),this.children=[],this.parent=null,this.hasReadyBeenCalled=!1}stepEntry(t,e){this.children.forEach(s=>s.stepEntry(t,e)),this.hasReadyBeenCalled||(this.hasReadyBeenCalled=!0,this.ready()),this.step(t,e)}ready(){}step(t){}draw(t,e,s){const n=e+this.position.x,o=s+this.position.y;this.drawImage(t,n,o),this.children.forEach(a=>a.draw(t,n,o))}drawImage(t,e,s){}destroy(){this.children.forEach(t=>{t.destroy()}),this.parent.removeChild(this)}addChild(t){t.parent=this,this.children.push(t)}removeChild(t){R.unsubscribe(t),this.children=this.children.filter(e=>t!==e)}}class x extends M{constructor({resource:t,frameSize:e,hFrames:s,vFrames:n,frame:o,scale:a,position:c,animations:m}){super({name}),this.resource=t,this.frameSize=e??new l(16,16),this.hFrames=s??1,this.vFrames=n??1,this.frame=o??0,this.frameMap=new Map,this.scale=a??1,this.position=c??new l(0,0),this.animations=m??null,this.buildFrameMap()}buildFrameMap(){let t=0;for(let e=0;e<this.vFrames;e++)for(let s=0;s<this.hFrames;s++)this.frameMap.set(t,new l(this.frameSize.x*s,this.frameSize.y*e)),t++}step(t){this.animations&&(this.animations.step(t),this.frame=this.animations.frame)}drawImage(t,e,s){if(!this.resource.isLoaded)return;let n=0,o=0;const a=this.frameMap.get(this.frame);a&&(n=a.x,o=a.y);const c=this.frameSize.x,m=this.frameSize.y;t.drawImage(this.resource.image,n,o,c,m,e,s,c*this.scale,m*this.scale)}}class q{constructor(t,e){A(this,"mainLoop",t=>{if(!this.isRunning)return;let e=t-this.lastFrameTime;for(this.lastFrameTime=t,this.accumulatedTime+=e;this.accumulatedTime>=this.timeStep;)this.update(this.timeStep),this.accumulatedTime-=this.timeStep;this.render(),this.rafId=requestAnimationFrame(this.mainLoop)});this.lastFrameTime=0,this.accumulatedTime=0,this.timeStep=1e3/60,this.update=t,this.render=e,this.rafId=null,this.isRunning=!1}start(){this.isRunning||(this.isRunning=!0,this.rafId=requestAnimationFrame(this.mainLoop))}stop(){this.rafId&&cancelAnimationFrame(this.rafId),this.isRunning=!1}}const D="LEFT",W="RIGHT",z="UP",L="DOWN";class G{constructor(){this.heldDirections=[],document.addEventListener("keydown",t=>{(t.code==="ArrowUp"||t.code==="KeyW")&&this.onArrowPressed(z),(t.code==="ArrowDown"||t.code==="KeyS")&&this.onArrowPressed(L),(t.code==="ArrowLeft"||t.code==="KeyA")&&this.onArrowPressed(D),(t.code==="ArrowRight"||t.code==="KeyD")&&this.onArrowPressed(W)}),document.addEventListener("keyup",t=>{(t.code==="ArrowUp"||t.code==="KeyW")&&this.onArrowReleased(z),(t.code==="ArrowDown"||t.code==="KeyS")&&this.onArrowReleased(L),(t.code==="ArrowLeft"||t.code==="KeyA")&&this.onArrowReleased(D),(t.code==="ArrowRight"||t.code==="KeyD")&&this.onArrowReleased(W)})}get direction(){return this.heldDirections[0]}onArrowPressed(t){this.heldDirections.indexOf(t)===-1&&this.heldDirections.unshift(t)}onArrowReleased(t){const e=this.heldDirections.indexOf(t);e!==-1&&this.heldDirections.splice(e,1)}}const g=i=>i*16,$=(i,t,e)=>{const s=`${t},${e}`;return!i.has(s)},C=new Set;C.add("144,48");C.add("160,48");C.add("176,64");C.add("128,48");C.add("112,48");class j{constructor(t){this.patterns=t,this.activeKey=Object.keys(this.patterns)[0]}get frame(){return this.patterns[this.activeKey].frame}play(t,e=0){this.activeKey!==t&&(this.activeKey=t,this.patterns[this.activeKey].currentTime=e)}step(t){this.patterns[this.activeKey].step(t)}}class b{constructor(t){this.currentTime=0,this.animationConfig=t,this.duration=t.duration??500}get frame(){const{frames:t}=this.animationConfig;for(let e=t.length-1;e>=0;e--)if(this.currentTime>=t[e].time)return t[e].frame;throw"Time is before the first keyframe"}step(t){this.currentTime+=t,this.currentTime>=this.duration&&(this.currentTime=0)}}const F=(i=0)=>({duration:400,frames:[{time:0,frame:i}]}),H=(i=0)=>({duration:400,frames:[{time:0,frame:i+1},{time:100,frame:i},{time:200,frame:i+1},{time:300,frame:i+2}]}),Z=F(1),J=F(4),Q=F(7),V=F(10),tt=H(0),et=H(3),it=H(6),st=H(9),nt={duration:400,frames:[{time:0,frame:12}]};function ot(i,t,e){let s=t.x-i.position.x,n=t.y-i.position.y,o=Math.sqrt(s**2+n**2);if(o<=e)i.position.x=t.x,i.position.y=t.y;else{let a=s/o,c=n/o;i.position.x+=a*e,i.position.y+=c*e,s=t.x-i.position.x,n=t.y-i.position.y,o=Math.sqrt(s**2+n**2)}return o}class at extends M{constructor(e,s){super({position:new l(e,s)});A(this,"w");const n=new x({resource:S.images.shadow,frameSize:new l(32,32),position:new l(-8,-19)});this.addChild(n),this.body=new x({resource:S.images.hero,frameSize:new l(32,32),hFrames:3,vFrames:8,frame:1,position:new l(-8,-20),animations:new j({walkDown:new b(tt),walkUp:new b(it),walkLeft:new b(st),walkRight:new b(et),standDown:new b(Z),standUp:new b(Q),standLeft:new b(V),standRight:new b(J),pickUpDown:new b(nt)})}),this.addChild(this.body),this.facingDirection=L,this.destinationPosition=this.position.duplicate(),this.itemPickupTime=0,this.itemPickupShell=null,R.on("HERO_PICKS_UP_ITEM",this,o=>{this.onPickUpItem(o)})}step(e,s){if(this.itemPickupTime>0){this.workOnItemPickup(e);return}ot(this,this.destinationPosition,1)<=1&&this.tryMove(s),this.tryEmitPosition()}tryEmitPosition(){this.lastX===this.position.x&&this.lastY===this.position.y||(this.lastX=this.position.x,this.lastY=this.position.y,Math.floor(this.position.x/16),Math.floor(this.position.y/16),R.emit("HERO_POSITION",this.position))}tryMove(e){const{input:s}=e;if(!s.direction){this.facingDirection===D&&this.body.animations.play("standLeft"),this.facingDirection===W&&this.body.animations.play("standRight"),this.facingDirection===z&&this.body.animations.play("standUp"),this.facingDirection===L&&this.body.animations.play("standDown");return}let n=this.destinationPosition.x,o=this.destinationPosition.y;const a=16;s.direction===L&&(o+=a,this.body.animations.play("walkDown")),s.direction===z&&(o-=a,this.body.animations.play("walkUp")),s.direction===D&&(n-=a,this.body.animations.play("walkLeft")),s.direction===W&&(n+=a,this.body.animations.play("walkRight")),this.facingDirection=s.direction??this.facingDirection,$(C,n,o)&&(this.destinationPosition.x=n,this.destinationPosition.y=o)}onPickUpItem({image:e,position:s}){this.destinationPosition=s.duplicate(),this.itemPickupTime=500,this.itemPickupShell=new M({}),this.itemPickupShell.addChild(new x({resource:e,position:new l(0,-18)})),this.addChild(this.itemPickupShell)}workOnItemPickup(e){this.itemPickupTime-=e,this.body.animations.play("pickUpDown"),this.itemPickupTime<=0&&this.itemPickupShell.destroy()}}class rt extends M{constructor(){super({}),R.on("HERO_POSITION",this,t=>{this.position=new l(-t.x+152,-t.y+82)})}}class dt extends M{constructor(){super({position:new l(0,1)}),this.nextId=0,this.items=[],R.on("HERO_PICKS_UP_ITEM",this,t=>{this.nextId+=1,this.items.push({id:this.nextId,image:S.images.rod}),this.renderInventory()}),this.renderInventory()}renderInventory(){this.children.forEach(t=>t.destroy()),this.items.forEach((t,e)=>{const s=new x({resource:t.image,position:new l(e*12,0)});this.addChild(s)})}removeFromInventory(t){this.items=this.items.filter(e=>e.id!==t),this.renderInventory()}}const f=document.createElement("div");f.innerText="Will you be my valentine? ❤️ - Ken";f.style.position="absolute";f.style.fontFamily="'Press Start 2P', 'Courier New', monospace";f.style.fontSize="24px";f.style.color="#222";f.style.pointerEvents="none";f.style.display="none";document.body.appendChild(f);let Y=!1,h=null;const d=document.createElement("button");d.innerText="Yes";d.style.position="absolute";d.style.fontFamily="'Press Start 2P', 'Courier New', monospace";d.style.fontSize="18px";d.style.padding="8px 24px";d.style.display="none";d.style.zIndex=10;d.style.background="#e0c080";d.style.border="4px solid #7c5c2c";d.style.borderRadius="0";d.style.boxShadow="0 0 0 2px #fff inset, 2px 2px 0 #7c5c2c";d.style.color="#3a2a0a";d.style.textShadow="1px 1px 0 #fff, -1px -1px 0 #fff";d.style.cursor="pointer";d.style.outline="none";d.style.transition="background 0.2s, box-shadow 0.2s";d.addEventListener("mouseenter",()=>{d.style.background="#fff6d6",d.style.boxShadow="0 0 0 2px #fff inset, 4px 4px 0 #7c5c2c"});d.addEventListener("mouseleave",()=>{d.style.background="#e0c080",d.style.boxShadow="0 0 0 2px #fff inset, 2px 2px 0 #7c5c2c"});document.body.appendChild(d);const r=document.createElement("button");r.innerText="No";r.style.position="absolute";r.style.fontFamily="'Press Start 2P', 'Courier New', monospace";r.style.fontSize="18px";r.style.padding="8px 24px";r.style.display="none";r.style.zIndex=10;r.style.background="#e0c080";r.style.border="4px solid #7c5c2c";r.style.borderRadius="0";r.style.boxShadow="0 0 0 2px #fff inset, 2px 2px 0 #7c5c2c";r.style.color="#3a2a0a";r.style.textShadow="1px 1px 0 #fff, -1px -1px 0 #fff";r.style.cursor="pointer";r.style.outline="none";r.style.transition="background 0.2s, box-shadow 0.2s";r.addEventListener("mouseenter",()=>{r.style.background="#fff6d6",r.style.boxShadow="0 0 0 2px #fff inset, 4px 4px 0 #7c5c2c";const i=E.getBoundingClientRect(),t=window.innerWidth,e=window.innerHeight,s=100,n=40,o=Math.max(i.left,0),a=Math.min(i.right-s,t-s),c=Math.max(i.top,0),m=Math.min(i.bottom-n,e-n),I=o+Math.random()*(a-o),O=c+Math.random()*(m-c);r.style.left=Math.round(I)+"px",r.style.top=Math.round(O)+"px"});r.addEventListener("mouseleave",()=>{r.style.background="#e0c080",r.style.boxShadow="0 0 0 2px #fff inset, 2px 2px 0 #7c5c2c"});document.body.appendChild(r);d.addEventListener("click",()=>{if(h&&(h.remove(),h=null),h=document.createElement("div"),h.className="tenor-gif-embed",h.setAttribute("data-postid","11680171459206479686"),h.setAttribute("data-share-method","host"),h.setAttribute("data-aspect-ratio","1"),h.setAttribute("data-width","120px"),h.style.position="absolute",h.style.top="-800px",h.style.width="120px",h.style.maxWidth="120px",h.style.minWidth="120px",h.style.transform="translate(-50%, 0)",h.style.zIndex="10000",document.body.appendChild(h),!document.getElementById("tenor-embed-script")){const o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src="https://tenor.com/embed.js",o.id="tenor-embed-script",document.body.appendChild(o)}new Audio("win.mp3").play(),new Audio("celebration.mp3").play(),y&&(y.destroy(),y=null,T=!1),w&&(w.destroy(),w=null,k=!1),f.style.display="none",d.style.display="none",r.style.display="none",Y=!0;const e=document.createElement("div");e.style.position="fixed",e.style.left="0",e.style.top="0",e.style.width="100vw",e.style.height="100vh",e.style.pointerEvents="none",e.style.zIndex="9999",document.body.appendChild(e);const s=["#f9d423","#ff4e50","#a1ffce","#38b2ac","#ff6e7f","#bfe9ff","#fbc2eb","#fdc2a2"];for(let o=0;o<80;o++){const a=document.createElement("div");a.style.position="absolute",a.style.width="12px",a.style.height="12px",a.style.background=s[Math.floor(Math.random()*s.length)],a.style.borderRadius=Math.random()>.5?"50%":"0",a.style.left=Math.random()*window.innerWidth+"px",a.style.top="0",a.style.opacity="0.85",a.style.transform=`rotate(${Math.random()*360}deg)`,a.style.boxShadow="0 2px 6px rgba(0,0,0,0.1)",a.style.animation=`confetti-fall ${2+Math.random()*2}s linear forwards`,e.appendChild(a)}const n=document.createElement("style");n.innerHTML=`@keyframes confetti-fall {
    0% { opacity: 0.85; }
    80% { opacity: 0.85; }
    100% { top: 100vh; opacity: 0; }
  }`,document.head.appendChild(n),setTimeout(()=>{e.remove(),n.remove()},4e3)});r.addEventListener("mouseenter",()=>{const i=E.getBoundingClientRect(),t=window.innerWidth,e=window.innerHeight,s=100,n=40,o=Math.max(i.left,0),a=Math.min(i.right-s,t-s),c=Math.max(i.top,0),m=Math.min(i.bottom-n,e-n),I=o+Math.random()*(a-o),O=c+Math.random()*(m-c);r.style.left=Math.round(I)+"px",r.style.top=Math.round(O)+"px"});const E=document.querySelector("#game-canvas"),p=E.getContext("2d");p.imageSmoothingEnabled=!1;const u=new M({position:new l(0,0)}),lt=new x({resource:S.images.sky,frameSize:new l(1920,960),scale:.3}),ct=new x({resource:S.images.ground,frameSize:new l(320,180),position:new l(g(-3),g(0))});u.addChild(ct);const ht=new x({resource:S.images.house,frameSize:new l(80,112),position:new l(g(7),g(-2))});u.addChild(ht);let w=null,k=!1,y=null,T=!1;window.addEventListener("keydown",i=>{i.key.toLowerCase()==="e"&&k&&!T&&(y=new x({resource:S.images.letter,frameSize:new l(1e3,180),scale:.5,position:new l(g(5),g(.5))}),u.addChild(y),T=!0)});const K=new x({resource:S.images.mail,frameSize:new l(200,200),scale:.3,position:new l(g(9.8),g(.5))});u.addChild(K);let N=0;const pt=K.position.y,P=new at(g(9),g(4));u.addChild(P);const v=new rt;u.addChild(v);const mt=new dt;u.input=new G;const ft=i=>{if(h){const c=E.getBoundingClientRect(),m=P.position.x+v.position.x+c.left;P.position.y+v.position.y+c.top-100,h.style.left=Math.round(m)+"px",h.style.top="-500px"}if(!k&&T&&y&&(y.destroy(),y=null,T=!1,f.style.display="none",d.style.display="none",r.style.display="none"),T&&y){f.style.display="block",d.style.display="block",r.style.display="block";const c=E.getBoundingClientRect(),m=y.position.x+v.position.x+c.left+400,I=y.position.y+v.position.y+c.top+180;f.style.left=Math.round(m)+"px",f.style.top=Math.round(I)+"px",d.style.left=Math.round(m)+"px",d.style.top=Math.round(I+40)+"px",(r.style.left===""||r.style.display==="none")&&(r.style.left=Math.round(m+120)+"px",r.style.top=Math.round(I+40)+"px")}else f.style.display="none",d.style.display="none",r.style.display="none";u.stepEntry(i,u),N+=i;const t=1,e=.004;K.position.y=pt+Math.sin(N*e)*t;const s=P.position.x,n=P.position.y,o=[{x:160,y:64},{x:176,y:80},{x:192,y:64}];let a=!1;for(const c of o)if(Math.abs(s-c.x)<2&&Math.abs(n-c.y)<2){a=!0;break}a?k?(w.position.x=s,w.position.y=n-24):(w=new x({resource:S.images.icon,frameSize:new l(1e3,1e3),scale:.02,position:new l(s-20,n-300)}),u.addChild(w),k=!0):k&&w&&(w.destroy(),w=null,k=!1)},yt=()=>{if(p.clearRect(0,0,E.width,E.height),lt.drawImage(p,0,0),p.save(),p.translate(v.position.x,v.position.y),u.draw(p,0,0),k&&P&&!T&&!Y){p.save(),p.font="bold 16px 'Press Start 2P', 'Courier New', monospace",p.fillStyle="#fff",p.strokeStyle="#000",p.lineWidth=2;const i="PRESS E",t=P.position.x+v.position.x-40,e=P.position.y+v.position.y+50;p.strokeText(i,t,e),p.fillText(i,t,e),p.restore()}p.restore(),mt.draw(p,0,0)},ut=new q(ft,yt);ut.start();
