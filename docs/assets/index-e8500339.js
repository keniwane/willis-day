var Y=Object.defineProperty;var _=(i,t,e)=>t in i?Y(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var C=(i,t,e)=>(_(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function e(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=e(o);fetch(o.href,n)}})();class U{constructor(){this.toLoad={sky:"sprites/sky.png",ground:"sprites/ground.png",hero:"sprites/hero-sheet.png",shadow:"sprites/shadow.png",rod:"sprites/rod.png",house:"sprites/house.png",mail:"sprites/mail.png",icon:"sprites/icon.png",letter:"sprites/letter.png"},this.images={},Object.keys(this.toLoad).forEach(t=>{const e=new Image;e.src=this.toLoad[t],this.images[t]={image:e,isLoaded:!1},e.onload=()=>{this.images[t].isLoaded=!0}})}}const v=new U;class d{constructor(t=0,e=0){this.x=t,this.y=e}duplicate(){return new d(this.x,this.y)}}class X{constructor(){C(this,"callbacks",[]);C(this,"nextId",0)}emit(t,e){this.callbacks.forEach(s=>{s.eventName===t&&s.callback(e)})}on(t,e,s){return this.nextId+=1,this.callbacks.push({id:this.nextId,eventName:t,caller:e,callback:s}),this.nextId}off(t){this.callbacks=this.callbacks.filter(e=>e.id!==t)}unsubscribe(t){this.callbacks=this.callbacks.filter(e=>e.caller!==t)}}const L=new X;class T{constructor({position:t}){this.position=t??new d(0,0),this.children=[],this.parent=null,this.hasReadyBeenCalled=!1}stepEntry(t,e){this.children.forEach(s=>s.stepEntry(t,e)),this.hasReadyBeenCalled||(this.hasReadyBeenCalled=!0,this.ready()),this.step(t,e)}ready(){}step(t){}draw(t,e,s){const o=e+this.position.x,n=s+this.position.y;this.drawImage(t,o,n),this.children.forEach(l=>l.draw(t,o,n))}drawImage(t,e,s){}destroy(){this.children.forEach(t=>{t.destroy()}),this.parent.removeChild(this)}addChild(t){t.parent=this,this.children.push(t)}removeChild(t){L.unsubscribe(t),this.children=this.children.filter(e=>t!==e)}}class x extends T{constructor({resource:t,frameSize:e,hFrames:s,vFrames:o,frame:n,scale:l,position:c,animations:m}){super({name}),this.resource=t,this.frameSize=e??new d(16,16),this.hFrames=s??1,this.vFrames=o??1,this.frame=n??0,this.frameMap=new Map,this.scale=l??1,this.position=c??new d(0,0),this.animations=m??null,this.buildFrameMap()}buildFrameMap(){let t=0;for(let e=0;e<this.vFrames;e++)for(let s=0;s<this.hFrames;s++)this.frameMap.set(t,new d(this.frameSize.x*s,this.frameSize.y*e)),t++}step(t){this.animations&&(this.animations.step(t),this.frame=this.animations.frame)}drawImage(t,e,s){if(!this.resource.isLoaded)return;let o=0,n=0;const l=this.frameMap.get(this.frame);l&&(o=l.x,n=l.y);const c=this.frameSize.x,m=this.frameSize.y;t.drawImage(this.resource.image,o,n,c,m,e,s,c*this.scale,m*this.scale)}}class B{constructor(t,e){C(this,"mainLoop",t=>{if(!this.isRunning)return;let e=t-this.lastFrameTime;for(this.lastFrameTime=t,this.accumulatedTime+=e;this.accumulatedTime>=this.timeStep;)this.update(this.timeStep),this.accumulatedTime-=this.timeStep;this.render(),this.rafId=requestAnimationFrame(this.mainLoop)});this.lastFrameTime=0,this.accumulatedTime=0,this.timeStep=1e3/60,this.update=t,this.render=e,this.rafId=null,this.isRunning=!1}start(){this.isRunning||(this.isRunning=!0,this.rafId=requestAnimationFrame(this.mainLoop))}stop(){this.rafId&&cancelAnimationFrame(this.rafId),this.isRunning=!1}}const R="LEFT",D="RIGHT",W="UP",A="DOWN";class q{constructor(){this.heldDirections=[],document.addEventListener("keydown",t=>{(t.code==="ArrowUp"||t.code==="KeyW")&&this.onArrowPressed(W),(t.code==="ArrowDown"||t.code==="KeyS")&&this.onArrowPressed(A),(t.code==="ArrowLeft"||t.code==="KeyA")&&this.onArrowPressed(R),(t.code==="ArrowRight"||t.code==="KeyD")&&this.onArrowPressed(D)}),document.addEventListener("keyup",t=>{(t.code==="ArrowUp"||t.code==="KeyW")&&this.onArrowReleased(W),(t.code==="ArrowDown"||t.code==="KeyS")&&this.onArrowReleased(A),(t.code==="ArrowLeft"||t.code==="KeyA")&&this.onArrowReleased(R),(t.code==="ArrowRight"||t.code==="KeyD")&&this.onArrowReleased(D)})}get direction(){return this.heldDirections[0]}onArrowPressed(t){this.heldDirections.indexOf(t)===-1&&this.heldDirections.unshift(t)}onArrowReleased(t){const e=this.heldDirections.indexOf(t);e!==-1&&this.heldDirections.splice(e,1)}}const g=i=>i*16,G=(i,t,e)=>{const s=`${t},${e}`;return!i.has(s)},M=new Set;M.add("144,48");M.add("160,48");M.add("176,64");M.add("128,48");M.add("112,48");class ${constructor(t){this.patterns=t,this.activeKey=Object.keys(this.patterns)[0]}get frame(){return this.patterns[this.activeKey].frame}play(t,e=0){this.activeKey!==t&&(this.activeKey=t,this.patterns[this.activeKey].currentTime=e)}step(t){this.patterns[this.activeKey].step(t)}}class b{constructor(t){this.currentTime=0,this.animationConfig=t,this.duration=t.duration??500}get frame(){const{frames:t}=this.animationConfig;for(let e=t.length-1;e>=0;e--)if(this.currentTime>=t[e].time)return t[e].frame;throw"Time is before the first keyframe"}step(t){this.currentTime+=t,this.currentTime>=this.duration&&(this.currentTime=0)}}const z=(i=0)=>({duration:400,frames:[{time:0,frame:i}]}),O=(i=0)=>({duration:400,frames:[{time:0,frame:i+1},{time:100,frame:i},{time:200,frame:i+1},{time:300,frame:i+2}]}),j=z(1),Z=z(4),J=z(7),Q=z(10),V=O(0),tt=O(3),et=O(6),it=O(9),st={duration:400,frames:[{time:0,frame:12}]};function nt(i,t,e){let s=t.x-i.position.x,o=t.y-i.position.y,n=Math.sqrt(s**2+o**2);if(n<=e)i.position.x=t.x,i.position.y=t.y;else{let l=s/n,c=o/n;i.position.x+=l*e,i.position.y+=c*e,s=t.x-i.position.x,o=t.y-i.position.y,n=Math.sqrt(s**2+o**2)}return n}class ot extends T{constructor(e,s){super({position:new d(e,s)});C(this,"w");const o=new x({resource:v.images.shadow,frameSize:new d(32,32),position:new d(-8,-19)});this.addChild(o),this.body=new x({resource:v.images.hero,frameSize:new d(32,32),hFrames:3,vFrames:8,frame:1,position:new d(-8,-20),animations:new $({walkDown:new b(V),walkUp:new b(et),walkLeft:new b(it),walkRight:new b(tt),standDown:new b(j),standUp:new b(J),standLeft:new b(Q),standRight:new b(Z),pickUpDown:new b(st)})}),this.addChild(this.body),this.facingDirection=A,this.destinationPosition=this.position.duplicate(),this.itemPickupTime=0,this.itemPickupShell=null,L.on("HERO_PICKS_UP_ITEM",this,n=>{this.onPickUpItem(n)})}step(e,s){if(this.itemPickupTime>0){this.workOnItemPickup(e);return}nt(this,this.destinationPosition,1)<=1&&this.tryMove(s),this.tryEmitPosition()}tryEmitPosition(){this.lastX===this.position.x&&this.lastY===this.position.y||(this.lastX=this.position.x,this.lastY=this.position.y,Math.floor(this.position.x/16),Math.floor(this.position.y/16),L.emit("HERO_POSITION",this.position))}tryMove(e){const{input:s}=e;if(!s.direction){this.facingDirection===R&&this.body.animations.play("standLeft"),this.facingDirection===D&&this.body.animations.play("standRight"),this.facingDirection===W&&this.body.animations.play("standUp"),this.facingDirection===A&&this.body.animations.play("standDown");return}let o=this.destinationPosition.x,n=this.destinationPosition.y;const l=16;s.direction===A&&(n+=l,this.body.animations.play("walkDown")),s.direction===W&&(n-=l,this.body.animations.play("walkUp")),s.direction===R&&(o-=l,this.body.animations.play("walkLeft")),s.direction===D&&(o+=l,this.body.animations.play("walkRight")),this.facingDirection=s.direction??this.facingDirection,G(M,o,n)&&(this.destinationPosition.x=o,this.destinationPosition.y=n)}onPickUpItem({image:e,position:s}){this.destinationPosition=s.duplicate(),this.itemPickupTime=500,this.itemPickupShell=new T({}),this.itemPickupShell.addChild(new x({resource:e,position:new d(0,-18)})),this.addChild(this.itemPickupShell)}workOnItemPickup(e){this.itemPickupTime-=e,this.body.animations.play("pickUpDown"),this.itemPickupTime<=0&&this.itemPickupShell.destroy()}}class rt extends T{constructor(){super({}),L.on("HERO_POSITION",this,t=>{this.position=new d(-t.x+152,-t.y+82)})}}class at extends T{constructor(){super({position:new d(0,1)}),this.nextId=0,this.items=[],L.on("HERO_PICKS_UP_ITEM",this,t=>{this.nextId+=1,this.items.push({id:this.nextId,image:v.images.rod}),this.renderInventory()}),this.renderInventory()}renderInventory(){this.children.forEach(t=>t.destroy()),this.items.forEach((t,e)=>{const s=new x({resource:t.image,position:new d(e*12,0)});this.addChild(s)})}removeFromInventory(t){this.items=this.items.filter(e=>e.id!==t),this.renderInventory()}}const f=document.createElement("div");f.innerText="Will you be my valentine? ❤️ - Ken";f.style.position="absolute";f.style.fontFamily="'Press Start 2P', 'Courier New', monospace";f.style.fontSize="24px";f.style.color="#222";f.style.pointerEvents="none";f.style.display="none";document.body.appendChild(f);let N=!1;const a=document.createElement("button");a.innerText="Yes";a.style.position="absolute";a.style.fontFamily="'Press Start 2P', 'Courier New', monospace";a.style.fontSize="18px";a.style.padding="8px 24px";a.style.display="none";a.style.zIndex=10;a.style.background="#e0c080";a.style.border="4px solid #7c5c2c";a.style.borderRadius="0";a.style.boxShadow="0 0 0 2px #fff inset, 2px 2px 0 #7c5c2c";a.style.color="#3a2a0a";a.style.textShadow="1px 1px 0 #fff, -1px -1px 0 #fff";a.style.cursor="pointer";a.style.outline="none";a.style.transition="background 0.2s, box-shadow 0.2s";a.addEventListener("mouseenter",()=>{a.style.background="#fff6d6",a.style.boxShadow="0 0 0 2px #fff inset, 4px 4px 0 #7c5c2c"});a.addEventListener("mouseleave",()=>{a.style.background="#e0c080",a.style.boxShadow="0 0 0 2px #fff inset, 2px 2px 0 #7c5c2c"});document.body.appendChild(a);const r=document.createElement("button");r.innerText="No";r.style.position="absolute";r.style.fontFamily="'Press Start 2P', 'Courier New', monospace";r.style.fontSize="18px";r.style.padding="8px 24px";r.style.display="none";r.style.zIndex=10;r.style.background="#e0c080";r.style.border="4px solid #7c5c2c";r.style.borderRadius="0";r.style.boxShadow="0 0 0 2px #fff inset, 2px 2px 0 #7c5c2c";r.style.color="#3a2a0a";r.style.textShadow="1px 1px 0 #fff, -1px -1px 0 #fff";r.style.cursor="pointer";r.style.outline="none";r.style.transition="background 0.2s, box-shadow 0.2s";r.addEventListener("mouseenter",()=>{r.style.background="#fff6d6",r.style.boxShadow="0 0 0 2px #fff inset, 4px 4px 0 #7c5c2c";const i=E.getBoundingClientRect(),t=window.innerWidth,e=window.innerHeight,s=100,o=40,n=Math.max(i.left,0),l=Math.min(i.right-s,t-s),c=Math.max(i.top,0),m=Math.min(i.bottom-o,e-o),h=n+Math.random()*(l-n),F=c+Math.random()*(m-c);r.style.left=Math.round(h)+"px",r.style.top=Math.round(F)+"px"});r.addEventListener("mouseleave",()=>{r.style.background="#e0c080",r.style.boxShadow="0 0 0 2px #fff inset, 2px 2px 0 #7c5c2c"});document.body.appendChild(r);a.addEventListener("click",()=>{const i=document.createElement("div");i.style.position="fixed",i.style.left="0",i.style.top="0",i.style.width="100vw",i.style.height="100vh",i.style.pointerEvents="none",i.style.zIndex="9998",i.style.transition="background 0.1s",document.body.appendChild(i);const t=["rgba(255,0,0,0.25)","rgba(0,255,0,0.25)","rgba(0,0,255,0.25)","rgba(255,255,0,0.25)","rgba(0,255,255,0.25)","rgba(255,0,255,0.25)","rgba(255,255,255,0.18)"];let e=0;setInterval(()=>{i.style.background=t[e%t.length],e++},200),new Audio("win.mp3").play(),new Audio("celebration.mp3").play(),y&&(y.destroy(),y=null,P=!1),w&&(w.destroy(),w=null,S=!1),f.style.display="none",a.style.display="none",r.style.display="none",N=!0;const n=document.createElement("div");n.style.position="fixed",n.style.left="0",n.style.top="0",n.style.width="100vw",n.style.height="100vh",n.style.pointerEvents="none",n.style.zIndex="9999",document.body.appendChild(n);const l=["#f9d423","#ff4e50","#a1ffce","#38b2ac","#ff6e7f","#bfe9ff","#fbc2eb","#fdc2a2"];for(let m=0;m<80;m++){const h=document.createElement("div");h.style.position="absolute",h.style.width="12px",h.style.height="12px",h.style.background=l[Math.floor(Math.random()*l.length)],h.style.borderRadius=Math.random()>.5?"50%":"0",h.style.left=Math.random()*window.innerWidth+"px",h.style.top="0",h.style.opacity="0.85",h.style.transform=`rotate(${Math.random()*360}deg)`,h.style.boxShadow="0 2px 6px rgba(0,0,0,0.1)",h.style.animation=`confetti-fall ${2+Math.random()*2}s linear forwards`,n.appendChild(h)}const c=document.createElement("style");c.innerHTML=`@keyframes confetti-fall {
    0% { opacity: 0.85; }
    80% { opacity: 0.85; }
    100% { top: 100vh; opacity: 0; }
  }`,document.head.appendChild(c),setTimeout(()=>{n.remove(),c.remove()},4e3)});r.addEventListener("mouseenter",()=>{const i=E.getBoundingClientRect(),t=window.innerWidth,e=window.innerHeight,s=100,o=40,n=Math.max(i.left,0),l=Math.min(i.right-s,t-s),c=Math.max(i.top,0),m=Math.min(i.bottom-o,e-o),h=n+Math.random()*(l-n),F=c+Math.random()*(m-c);r.style.left=Math.round(h)+"px",r.style.top=Math.round(F)+"px"});const E=document.querySelector("#game-canvas"),p=E.getContext("2d");p.imageSmoothingEnabled=!1;const u=new T({position:new d(0,0)}),lt=new x({resource:v.images.sky,frameSize:new d(1920,960),scale:.3}),dt=new x({resource:v.images.ground,frameSize:new d(320,180),position:new d(g(-3),g(0))});u.addChild(dt);const ct=new x({resource:v.images.house,frameSize:new d(80,112),position:new d(g(7),g(-2))});u.addChild(ct);let w=null,S=!1,y=null,P=!1;window.addEventListener("keydown",i=>{i.key.toLowerCase()==="e"&&S&&!P&&(y=new x({resource:v.images.letter,frameSize:new d(1e3,180),scale:.5,position:new d(g(5),g(.5))}),u.addChild(y),P=!0)});const H=new x({resource:v.images.mail,frameSize:new d(200,200),scale:.3,position:new d(g(9.8),g(.5))});u.addChild(H);let K=0;const ht=H.position.y,I=new ot(g(9),g(4));u.addChild(I);const k=new rt;u.addChild(k);const pt=new at;u.input=new q;const mt=i=>{if(!S&&P&&y&&(y.destroy(),y=null,P=!1,f.style.display="none",a.style.display="none",r.style.display="none"),P&&y){f.style.display="block",a.style.display="block",r.style.display="block";const c=E.getBoundingClientRect(),m=y.position.x+k.position.x+c.left+400,h=y.position.y+k.position.y+c.top+180;f.style.left=Math.round(m)+"px",f.style.top=Math.round(h)+"px",a.style.left=Math.round(m)+"px",a.style.top=Math.round(h+40)+"px",(r.style.left===""||r.style.display==="none")&&(r.style.left=Math.round(m+120)+"px",r.style.top=Math.round(h+40)+"px")}else f.style.display="none",a.style.display="none",r.style.display="none";u.stepEntry(i,u),K+=i;const t=1,e=.004;H.position.y=ht+Math.sin(K*e)*t;const s=I.position.x,o=I.position.y,n=[{x:160,y:64},{x:176,y:80},{x:192,y:64}];let l=!1;for(const c of n)if(Math.abs(s-c.x)<2&&Math.abs(o-c.y)<2){l=!0;break}l?S?(w.position.x=s,w.position.y=o-24):(w=new x({resource:v.images.icon,frameSize:new d(1e3,1e3),scale:.02,position:new d(s-20,o-300)}),u.addChild(w),S=!0):S&&w&&(w.destroy(),w=null,S=!1)},ft=()=>{if(p.clearRect(0,0,E.width,E.height),lt.drawImage(p,0,0),p.save(),p.translate(k.position.x,k.position.y),u.draw(p,0,0),S&&I&&!P&&!N){p.save(),p.font="bold 16px 'Press Start 2P', 'Courier New', monospace",p.fillStyle="#fff",p.strokeStyle="#000",p.lineWidth=2;const i="PRESS E",t=I.position.x+k.position.x-40,e=I.position.y+k.position.y+50;p.strokeText(i,t,e),p.fillText(i,t,e),p.restore()}p.restore(),pt.draw(p,0,0)},yt=new B(mt,ft);yt.start();
